<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>诗仙李白 - 智能对话</title>
<style>
/* 新增全局盒模型设置 */
* {
  box-sizing: border-box;
}

/* 新增水墨背景 */
.watermark {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  opacity: 0.05;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><text x="50" y="50" font-family="KaiTi" font-size="24" text-anchor="middle" fill="black">李白</text></svg>');
  background-size: 400px;
  background-repeat: repeat;
  pointer-events: none;
  animation: float 30s linear infinite;
}

/* 水墨背景动画 */
@keyframes float {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 400px 400px;
  }
}

/* 优化主体样式 */
body {
  font-family: "KaiTi", "STKaiti", serif;
  margin: 0;
  padding: 0;
  height: 100vh;
  width: 100vw;
  position: relative;
  background: linear-gradient(135deg, #fdf6e3, #e0f7f4);
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

/* 优化应用容器 */
#app {
  background: rgba(255, 255, 255, 0.95);
  border: 2px solid #d4b483;
  border-radius: 12px;
  box-shadow: 0 4px 25px rgba(90, 67, 41, 0.3);
  width: 100%;
  height: 100%;
  max-width: 100vw;
  max-height: 100vh;
  padding: 20px;
  backdrop-filter: blur(5px);
  border-top: 12px solid #a3d2ca;
  display: flex;
  flex-direction: column;
}

/* 优化标题 */
h1 {
  font-family: "KaiTi", "STKaiti", serif;
  font-size: 1.8em;
  margin-top: 5px;
  margin-bottom: 20px;
  text-align: center;
  color: #5d4037;
  position: relative;
}

h1:after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 20%;
  width: 60%;
  height: 2px;
  background: linear-gradient(90deg, transparent, #d4b483, transparent);
}

/* 新增聊天容器 */
#chat-container {
    position: relative;
    margin-bottom: 15px;
    flex: 1;
    display: flex;
    flex-direction: column;
    max-height: calc(100vh - 200px);
}

#chat {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #d4b483;
    padding: 10px;
    border-radius: 6px;
    background: rgba(253, 246, 227, 0.8);
    margin-bottom: 10px;
    font-size: 1.05em;
    scroll-behavior: smooth;
    box-shadow: inset 0 2px 8px rgba(90, 67, 41, 0.1);
    position: relative;
    scrollbar-width: thin;
    scrollbar-color: #c1c1c1 #f1f1f1;
}

/* 添加浏览器兼容性处理 */
#chat::-webkit-scrollbar {
    width: 8px;
}

#chat::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

#chat::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}

#chat::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* 优化聊天框 */
#chat:before, #chat:after {
  content: "";
  position: absolute;
  height: 20px;
  width: 100%;
  left: 0;
  z-index: 2;
}

#chat:before {
  top: 0;
  background: linear-gradient(180deg, rgba(253,246,227,1) 0%, rgba(253,246,227,0) 100%);
}

#chat:after {
  bottom: 0;
  background: linear-gradient(0deg, rgba(253,246,227,1) 0%, rgba(253,246,227,0) 100%);
}

/* 重写消息样式 */
.message {
  margin-bottom: 18px;
  display: flex;
  flex-direction: column;
  animation: fadeIn 0.4s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.user {
  align-items: flex-end;
}

.bot {
  align-items: flex-start;
}

/* 新增消息内容样式 */
.message-content {
  max-width: 85%;
  padding: 12px 15px;
  border-radius: 15px;
  position: relative;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

.user .message-content {
  background: linear-gradient(135deg, #c1ece8, #e0f7f4);
  border-bottom-right-radius: 4px;
  border-left: 3px solid #5eaaa8;
}

.bot .message-content {
  background: linear-gradient(135deg, #fff8e1, #fdf6e3);
  border-bottom-left-radius: 4px;
  border-right: 3px solid #d4b483;
}

/* 新增消息头部 */
.message-header {
  font-size: 0.85em;
  margin-bottom: 5px;
  opacity: 0.7;
  display: flex;
  align-items: center;
}

.bot .message-header:before {
  content: "🎓";
  margin-right: 5px;
}

.user .message-header:before {
  content: "👤";
  margin-right: 5px;
}

/* 新增输入容器 */
.input-container {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* 优化文本输入框 */
textarea {
  width: 100%;
  height: 60px;
  resize: none;
  padding: 12px;
  font-size: 1em;
  border-radius: 6px;
  border: 1px solid #d4b483;
  font-family: "KaiTi", "STKaiti", serif;
  background: #fffaf0;
  box-shadow: inset 0 2px 8px rgba(90, 67, 41, 0.1);
  transition: all 0.3s ease;
}

textarea:focus {
  outline: none;
  border-color: #5eaaa8;
  box-shadow: 0 0 0 2px rgba(94, 170, 168, 0.2);
}

textarea::placeholder {
  color: #a99e8b;
  font-style: italic;
}

/* 优化按钮效果 */
button {
  padding: 10px;
  font-size: 1.1em;
  background: linear-gradient(to right, #a3d2ca, #5eaaa8);
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-family: "KaiTi", "STKaiti", serif;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(94, 170, 168, 0.3);
  position: relative;
  overflow: hidden;
}

button:hover {
  background: linear-gradient(to right, #5eaaa8, #a3d2ca);
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(94, 170, 168, 0.4);
}

button:active {
  transform: translateY(0);
}

button:after {
  content: "";
  position: absolute;
  top: -10%;
  left: -10%;
  width: 20%;
  height: 220%;
  background: rgba(255,255,255,0.3);
  transform: rotate(15deg);
  transition: all 0.5s ease;
  opacity: 0;
}

button:hover:after {
  left: 120%;
  opacity: 1;
  transition-delay: 0.1s;
}

button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
  box-shadow: none;
}

/* 新增打字指示器 */
.typing-indicator {
  display: none;
  background: #fdf6e3;
  padding: 8px 12px;
  border-radius: 18px;
  margin-left: 15px;
  font-size: 0.9em;
  color: #5d4037;
  font-style: italic;
  align-self: flex-start;
}

.typing-indicator span {
  animation: dot-pulse 1.5s infinite;
  opacity: 0;
}

/* 打字动画 */
@keyframes dot-pulse {
  0%, 20% {
    opacity: 0.2;
  }
  50% {
    opacity: 1;
  }
  80%, 100% {
    opacity: 0.2;
  }
}

/* 新增水印 */
#watermark {
  position: fixed;
  bottom: 15px;
  right: 15px;
  color: rgba(93, 64, 55, 0.4);
  font-size: 0.85em;
  z-index: 100;
}
</style>
</head>
<body>
<div class="watermark"></div>
<div id="app">
  <button id="backToChat" style="position: absolute; top: 10px; left: 10px; width: auto; padding: 8px 15px; font-size: 0.9em;">返回聊天</button>
  <h1>诗仙李白</h1>
  <div id="chat-container">
    <div id="chat"></div>
  </div>
  <div class="input-container">
    <textarea id="input" placeholder="与李白对话，请输入..."></textarea>
    <button id="sendBtn">举杯邀月</button>
  </div>
</div>
<div id="watermark">智能对话系统 © 2023</div>
<script>
  const chat = document.getElementById('chat');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');
  const watermark = document.querySelector('.watermark');
  const backToChatBtn = document.getElementById('backToChat');

  // 为水墨背景添加随机位置效果
  function animateWatermark() {
    if (watermark) {
      const x = Math.random() * 10 - 5;
      const y = Math.random() * 10 - 5;
      watermark.style.transform = `translate(${x}px, ${y}px)`;
    }
    requestAnimationFrame(() => setTimeout(animateWatermark, 5000));
  }
  animateWatermark();

  const API_KEY = "sk-22c0d14edbc44bb387114294798dfb63";
  const API_URL = "https://api.deepseek.com/v1/chat/completions";

  const systemPrompt = {
    role: "system",
    content: `你现在是一位大唐诗人李白。
 你以豪放、浪漫的风格作诗、吟诗、评诗，喜欢引用古诗词、自然景物与酒。
 回复中多用文言文或诗句，保持优雅潇洒之气。`
  };

  // 创建打字指示器
  const typingIndicator = document.createElement('div');
  typingIndicator.className = 'typing-indicator';
  typingIndicator.innerHTML = '李白正在构思... <span>.</span><span>.</span><span>.</span>';
  // 设置动画延迟
  typingIndicator.querySelectorAll('span').forEach((span, index) => {
    span.style.animationDelay = `${index * 0.3}s`;
  });

  function appendMessage(sender, text) {
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message');
    msgDiv.classList.add(sender);

    // 创建消息头部
    const headerDiv = document.createElement('div');
    headerDiv.classList.add('message-header');
    headerDiv.textContent = sender === 'user' ? '你' : '李白';

    // 创建消息内容
    const contentDiv = document.createElement('div');
    contentDiv.classList.add('message-content');
    contentDiv.textContent = text;

    // 组装消息元素
    msgDiv.appendChild(headerDiv);
    msgDiv.appendChild(contentDiv);
    chat.appendChild(msgDiv);

    // 滚动到底部
    chat.scrollTop = chat.scrollHeight;
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    // 添加用户消息
    appendMessage('user', text);
    input.value = '';
    sendBtn.disabled = true;
    sendBtn.textContent = "李白沉思中...";

    // 显示打字指示器
    chat.appendChild(typingIndicator);
    typingIndicator.style.display = 'block';
    chat.scrollTop = chat.scrollHeight;

    try {
      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${API_KEY}`
        },
        body: JSON.stringify({
          model: "deepseek-chat",
          messages: [
            systemPrompt,
            { role: "user", content: text }
          ],
          temperature: 0.85,
          max_tokens: 2000
        })
      });

      // 隐藏打字指示器
      typingIndicator.style.display = 'none';

      if (!response.ok) {
        throw new Error(`请求失败: HTTP ${response.status}`);
      }

      const data = await response.json();
      const reply = data.choices?.[0]?.message?.content || '无回复内容';
      appendMessage('bot', reply);

    } catch (error) {
      // 隐藏打字指示器
      typingIndicator.style.display = 'none';
      appendMessage('bot', error.message);
      console.error('API请求错误:', error);
    } finally {
      sendBtn.disabled = false;
      sendBtn.textContent = "举杯邀月";
      input.focus();
    }
  }

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // 页面加载完成后发送欢迎消息
  window.addEventListener('DOMContentLoaded', () => {
    appendMessage('bot', '在下李白，字太白，号青莲居士。今日有幸与君相逢，不知君有何雅兴？是想共论诗词，还是探讨人生哲理？但说无妨。');
    input.focus();
  });

  // 返回聊天页面
  backToChatBtn.addEventListener('click', () => {
    window.location.href = 'index.html?show=chat';
  });
</script>
</body>
</html>