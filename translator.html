<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>英文翻译老师</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Microsoft YaHei', Arial, sans-serif; background-color: #f7f9fc; margin: 0; padding: 0; height: 100vh; width: 100vw; display: flex; align-items: stretch; overflow: hidden; }
    #app { background: white; padding: 25px; box-shadow: none; width: 100%; height: 100%; display: flex; flex-direction: column; }
    .header { text-align: center; margin-bottom: 20px; position: relative; }
    .header i { position: absolute; right: 0; top: 50%; transform: translateY(-50%); color: #00b4d8; font-size: 1.2em; }
    h1 { font-size: 1.8em; margin-bottom: 5px; color: #333; font-weight: bold; }
    .subtitle { font-size: 0.9em; color: #666; margin-bottom: 15px; }
    #chat { flex: 1; overflow-y: auto; padding: 15px; border-radius: 8px; background: #fafafa; margin-bottom: 15px; min-height: 200px; }
    .message { margin-bottom: 15px; display: flex; align-items: flex-start; }
    /* 删除旧的.avatar样式 */
    .message-content { max-width: 75%; padding: 10px 12px; border-radius: 18px; word-break: break-word; position: relative; }
    .user { justify-content: flex-end; }
    .user .message-content { background-color: #e6f7ff; color: #333; border-top-left-radius: 4px; }
    .bot { justify-content: flex-start; }
    .bot .message-content { background-color: #00b4d8; color: white; border-top-right-radius: 4px; }
    .tag { font-size: 0.8em; font-weight: bold; margin-right: 5px; }
    textarea { width: 100%; height: 70px; resize: none; padding: 12px; font-size: 1em; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; margin-bottom: 10px; }
    button { margin-top: 5px; width: 100%; padding: 12px; font-size: 1em; background-color: #00b4d8; color: white; border: none; border-radius: 25px; cursor: pointer; display: flex; justify-content: center; align-items: center; font-weight: bold; transition: background-color 0.3s; }
    button:hover { background-color: #0096c7; }
    button i { margin-right: 8px; }
    button:disabled { background-color: #90e0ef; cursor: not-allowed; }
    .footer { text-align: center; font-size: 0.8em; color: #999; margin-top: 15px; }

    /* 新增的老师头像样式 */
    .teacher-avatar { 
       width: 40px; 
       height: 40px; 
       background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMyYzZlNzgiIGZpbGwtb3BhY2l0eT0iMC4xIi8+CjxwYXRoIGQ9Ik0yMy4xMTUgMjQuMDAxQzI1LjkzNCAyNC44NTQgMjguMDAxIDI2LjQ3IDI4LjAwMSAyOXYyLjAwMkEyIDIgMCAwIDEgMjYuMDAxIDMzaC0xMkEyIDIgMCAwIDEgMTIgMzF2LTIuMDAxYzAtMi41MzEgMi4wNjctNC4xNDcgNC44ODUtNC45OThsLS41MDEtLjUyM0EyMi41MyAyMi41MyAwIDAgMSAxNC44IDE1aDEwLjRsLS43OSA1LjE4NmEyMi41MzYgMjIuNTM2IDAgMCAxLTIuNzA1IDIuNjNsLS41MDYuNTM4eiIgZmlsbD0iIzJjNmU3OCI+PC9wYXRoPgo8Y2lyY2xlIGN4PSIxOCIgY3k9IjEyIiByPSIzIiBmaWxsPSIjMmM2ZTc4Ij48L2NpcmNsZT4KPGNpcmNsZSBjeD0iMjIiIGN5PSIxMiIgcj0iMyIgZmlsbD0iIzJjNmU3OCI+PC9jaXJjbGU+Cjwvc3ZnPg==') no-repeat center/cover; 
       border-radius: 50%; 
       margin-right: 10px; 
       flex-shrink: 0; 
     } 
     
     /* 新增的学生头像样式 */ 
     .student-avatar { 
       width: 40px; 
       height: 40px; 
       background: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiMxZTg0YWUiIGZpbGwtb3BhY2l0eT0iMC4xIi8+CjxwYXRoIGQ9Ik0yNyAxOGMwLTMuODctMy4xMzUtNy03LTdzLTcgMy4xMy03IDdjMCAyLjUyNiAxLjI0NiA0Ljc2MyAzLjE3MyA2LjE1Ni4zODIuMjguNjU4LjYwMS44MjcuOTQ4QzE0LjEzMSAyNy4xMjggMTMgMjkuNSAxMyAzMmgxNGMwLTIuNS0xLjEzLTQuODcyLTMtNi45MDEuMTY5LS4zNDguNDQ1LS42Ny44MjctLjk1MkMyNS43NTQgMjIuNzYgMjcgMjAuNTI0IDI3IDE4eiIgZmlsbD0iIzFlODRhZSI+PC9wYXRoPgo8cGF0aCBkPSJNMjcgMThjMC0zLjg3LTMuMTM1LTctNy03cy03IDMuMTMtNyA3YzAgMi41MjYgMS4yNDYgNC43NjMgMy4xNzMgNi4xNTYuMzgyLjI4LjY1OC42MDEuODI3Ljk0OEMxNC4xMzEgMjcuMTI4IDEzIDI5LjUgMTMgMzJoMTRjMC0yLjUtMS4xMy00Ljg3Mi0zLTYuOTAxLjE2OS0uMzQ4LjQ0NS0uNjcuODI3LS45NTJDMjUuNzU0IDIyLjc2IDI3IDIwLjUyNCAyNyAxOHoiIGZpbGw9IiMxZTg0YWUiIG9wYWNpdHk9IjAuOCI+PC9wYXRoPgo8Y2lyY2xlIGN4PSIyMCIgY3k9IjE4IiByPSI0IiBmaWxsPSIjMWU4NGFlIj48L2NpcmNsZT4KPC9zdmc+') no-repeat center/cover; 
       border-radius: 50%; 
       margin-left: 10px; 
       flex-shrink: 0; 
     }

    /* 媒体查询，针对大屏幕优化 */
    @media (min-width: 768px) {
      h1 { font-size: 2em; }
      .message-content { max-width: 80%; }
    }
  </style>
</head>
<body>
<div id="app">
  <div class="header">
    <button id="backToChat" style="position: absolute; top: 50%; left: 10px; transform: translateY(-50%); width: auto; padding: 8px 15px; font-size: 0.9em;">返回聊天</button>
    <h1>英文翻译老师</h1>
    <div class="subtitle">专业英语翻译 & 语言学习助手</div>
    <i class="fas fa-star"></i>
  </div>
  <div id="chat"></div>
  <textarea id="input" placeholder="请输入要翻译或学习的英文内容..."></textarea>
  <button id="sendBtn"><i class="fas fa-pencil-alt"></i> 翻译内容</button>
  <div class="footer">English Translation Teacher · 专业语言学习助手</div>
</div>

<script>
  const chat = document.getElementById('chat');
  const input = document.getElementById('input');
  const sendBtn = document.getElementById('sendBtn');
  const backToChatBtn = document.getElementById('backToChat');

  const API_KEY = "sk-22c0d14edbc44bb387114294798dfb63";
  const API_URL = "https://api.deepseek.com/v1/chat/completions";

  const sourceLang = "auto";  // 可以是 "auto"、"en"、"zh" 等
  const targetLang = "zh";    // 目标语言，如 "en"、"zh"

  // 初始化欢迎消息
  window.onload = function() {
    appendMessage('bot', '你好！我是你的英文翻译老师，可以叫我王老师。我可以帮你翻译英文内容，也可以解释语法要点！');
    appendMessage('bot', '只需输入你想要翻译的内容，我会提供专业译文和必要的解释。');
  };

  function appendMessage(sender, text) {
    const msgDiv = document.createElement('div');
    msgDiv.classList.add('message');
    msgDiv.classList.add(sender);

    // 添加头像
    const avatar = document.createElement('div');
    if (sender === 'user') {
      avatar.classList.add('student-avatar');
    } else {
      avatar.classList.add('teacher-avatar');
    }
    msgDiv.appendChild(avatar);

    // 添加消息内容
    const contentDiv = document.createElement('div');
    contentDiv.classList.add('message-content');
    
    // 创建标签
    const tagSpan = document.createElement('span');
    tagSpan.classList.add('tag');
    tagSpan.textContent = sender === 'user' ? '[学生]' : '[王老师]';
    contentDiv.appendChild(tagSpan);
    
    // 添加文本内容
    const textNode = document.createTextNode(' ' + text);
    contentDiv.appendChild(textNode);
    
    msgDiv.appendChild(contentDiv);
    chat.appendChild(msgDiv);
    chat.scrollTop = chat.scrollHeight;
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    appendMessage('user', text);
    input.value = '';
    sendBtn.disabled = true;

    const prompt = `请将以下内容从${sourceLang === "auto" ? "自动识别语言" : sourceLang}翻译成${targetLang}：\n\n${text}`;

    try {
      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${API_KEY}`
        },
        body: JSON.stringify({
          model: "deepseek-chat",
          messages: [
            {
              role: "system",
              content: "你是一位资深英语教师王老师，拥有丰富的教学经验。请按以下要求处理用户的翻译请求：\n1. 先提供准确、流畅的翻译\n2. 用[语法要点]标签详细分析句子结构、重点词汇或语法现象\n3. 用[学习建议]给出实用的记忆技巧或学习方法\n4. 用'这种表达常用于...'说明该表达的使用场景\n5. 用'这里需要注意...'提示常见错误或易混淆点\n保持专业、亲切的教学口吻，帮助学生更好地理解和掌握英语。"
            },
            { role: "user", content: prompt }
          ],
          temperature: 0.3,
          max_tokens: 1500
        })
      });

      if (!response.ok) throw new Error(`请求失败: HTTP ${response.status}`);

      const data = await response.json();
      const reply = data.choices?.[0]?.message?.content || '无翻译结果';
      appendMessage('bot', reply);

    } catch (error) {
      appendMessage('bot', '翻译失败：' + error.message);
      console.error('API请求错误:', error);
    } finally {
      sendBtn.disabled = false;
      input.focus();
    }
  }

  sendBtn.addEventListener('click', sendMessage);
  input.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });
  // 返回聊天页面
  backToChatBtn.addEventListener('click', () => {
    window.location.href = './index.html?show=chat';
  });
</script>
</body>
</html>