<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智能聊天系统</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <!-- tesseract.js v2/v3/v4 都支持 createWorker；如果用 v5 请确保用对应用法 -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>

</head>
<body>
  <!-- 主题切换按钮 -->
  <div class="theme-switcher">
    <button id="defaultTheme" class="theme-btn active" title="默认主题"><i class="fas fa-sun"></i></button>
    <button id="darkTheme" class="theme-btn" title="暗色主题"><i class="fas fa-moon"></i></button>
    <button id="eyeTheme" class="theme-btn" title="护眼主题"><i class="fas fa-leaf"></i></button>
  </div>

  <div class="container" id="accountSystem">
    <div class="header">
      <h1>智能聊天系统</h1>
      <p>安全账号与智能对话</p>
    </div>
    
    <div class="card">
      <div class="tabs">
        <div class="tab active" id="loginTab">账号登录</div>
        <div class="tab" id="registerTab">账号注册</div>
      </div>
      
      <!-- 注册表单 -->
      <div id="registerForm" style="display: none;">
        <div class="info-box">
          <i class="fas fa-info-circle"></i>
          <div>请输入您的邮箱地址作为账号，并设置8位以上安全密码</div>
        </div>
        
        <div class="form-group">
          <label for="registerAccount">邮箱地址</label>
          <div class="input-with-icon">
            <i class="fas fa-envelope"></i>
            <input type="email" id="registerAccount" class="form-control" placeholder="请输入您的邮箱地址" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="password">设置登录密码</label>
          <div class="input-with-icon">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" class="form-control" placeholder="至少8位字符，包含字母和数字">
          </div>
          <div class="password-strength">
            <div class="strength-meter" id="strengthMeter"></div>
          </div>
          <div class="strength-labels">
            <span class="strength-weak">弱</span>
            <span class="strength-medium">中</span>
            <span class="strength-strong">强</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">确认密码</label>
          <div class="input-with-icon">
            <i class="fas fa-lock"></i>
            <input type="password" id="confirmPassword" class="form-control" placeholder="再次输入密码">
          </div>
        </div>
        
        <button id="registerBtn" class="submit-btn">注册账号</button>
      </div>
      
      <!-- 登录表单 -->
      <div id="loginForm">
        <div class="form-group">
          <label for="loginAccount">邮箱地址</label>
          <div class="input-with-icon">
            <i class="fas fa-envelope"></i>
            <input type="email" id="loginAccount" class="form-control" placeholder="输入您的邮箱地址" required>
          </div>
        </div>
        
        <div class="form-group">
          <label for="loginPassword">登录密码</label>
          <div class="input-with-icon">
            <i class="fas fa-lock"></i>
            <input type="password" id="loginPassword" class="form-control" placeholder="输入您的密码">
          </div>
        </div>
        
        <div class="form-group" style="text-align: right;">
          <a href="#" style="color: #2575fc; text-decoration: none;">忘记密码?</a>
        </div>
        
        <button id="loginBtn" class="submit-btn">登录账号</button>
      </div>
    </div>
    
    <div class="footer">
      <p>© 2025 智能聊天系统 | <a href="#">隐私政策</a> | <a href="#">用户协议</a></p>
    </div>
  </div>

  <!-- 聊天页面 -->
  <div id="chatPage">
    <!-- 添加右侧智能体按钮容器 -->
    <div class="agent-buttons-container">
      <button id="newPageBtn" title="英文翻译老师">
        <i class="fas fa-language"></i>
        <span>英文翻译老师</span>
      </button>
      <button id="newPageBtn2" title="知心大姐姐">
        <i class="fas fa-file-alt"></i>
        <span>知心大姐姐</span>
      </button>
      <button id="newPageBtn3" title="诗仙李白">
        <i class="fas fa-file"></i>
        <span>诗仙李白</span>
      </button>
      <button id="newPageBtn4" title="自定义智能体">
        <i class="fas fa-file-code"></i>
        <span>自定义智能体</span>
      </button>
    </div>

    <div class="card">
      <div class="header">
        <h1>智能聊天助手</h1>
        <div class="chat-controls">
          <button id="historyBtn" title="历史记录">
            <i class="fas fa-history"></i>
          </button>
          <button id="userInfoBtn" title="账号信息">
            <i class="fas fa-user-circle"></i>
          </button>
          <button id="logoutBtn" title="退出登录">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>
      
      <!-- 添加聊天布局容器 -->
      <div class="chat-layout">
        <!-- 左侧历史记录栏 -->
        <div class="history-sidebar">
          <div class="sidebar-header">
            <h3>聊天记录</h3>
            <div class="history-controls-sidebar">
              <input type="text" id="searchInputSidebar" placeholder="搜索记录...">
              <button id="refreshHistoryBtnSidebar" class="refresh-btn-sidebar">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
          </div>
          <div id="historyListSidebar" class="history-items"></div>
        </div>
        
        <!-- 右侧聊天主区域 -->
        <div class="chat-main">
          <div id="app">
            <div id="chat">
              <div class="message bot">
                <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAlWVYSWZNTQAqAAAACAAEAQAAAwAAAAEFJwAAAQEAAwAAAAEElgAAh2kABAAAAAEAAAA+ARIAAwAAAAEAAQAAAAAAAAACkoYAAgAAAA8AAABckggABAAAAAEAAAAAAAAAAE9wbHVzXzE2OTA4Mjg4AAADvElEQVRYCe2XS2sTQRSGHyUhohJBghBpUuLIHtghgUpkNSQPqg6NRNw6cOHCxWfgQrVShfQX/Ai/gQIv4UWrZWs2Kixv01T9qjKoa9n5vL1l3dn95X8nNvrxkLzUIIYQQQvhxq3wLwAwgVdyusx9UBvSDVhWQTlQFKvejlWf8iCeMOypJdFh9cz1kHckm/wWFdn1DE9FcISiqDKcBNRRGdrho3hV1l7GVbNMYJcFiabPSl4G45t45thTLVf6B6B3wGgA4At1utw4bWIhj/0Vq1F7nqwADtDdoFxFzjcU26KDM4z3cNqNd30A5GLP5m6wF6JY5t6RZFlKItAF1hDQqCqUEZEvU4oJcHkF4zQQaL2tsWe8pPeYdMkqKhq6Z2kVJggdBUnVaQbUN4CzoYOg5nd7T7gC8gA3W2u4U6YMrJbHz5SKvhBqVmbEoMZgO9gnzCzRrLBGa8ALXIpn9C9nyJElPlH6uIfrwPsGtlk7YcwCDM/vJwSuWx11jt3RYA91iDqpv+TK5xzOBo64y49k2jQMe07A3HZjFbZ4A+msTKLgRRoYtkixM2VbBiXJSZ3FsAamNImf1gFZ9TIKAZ3KzOIoF6mjAqlUlgqUnbMuTFeuAa7sGlIYZlI3NcdjAqPQWYZFhxSDgCMXGIrj6dgC5KXGFpQkhxKHYSKx4rRkOcFjbQx8RIaTfH6DFIF9XAkxV2V/wB6hBnylUwwYBvmBPo2FxepuM5noEOGaX5R2U7gLNeG8Ox05sIfQ93yPgei8gwDNb+0AtXyq9kgTA2Zd6VGHYIRvAKTEm4uUypT7gTuyNGRDo3yY26Y9Z4WqK+wGS8WkMr7qdifJ9bQPSiE+tUAl5TgqbH/wYmvHoEYXBA1pbgqf3UGa3n1ja6Xnfnok0W3yeiW6OvmKy3OqXjPgvnNkR+FPKfKwbxSWvwAAAABJRU5ErkJggg==" alt="机器人头像" class="avatar">
                <div class="message-content">
                  您好！我是您的智能助手，请问有什么可以帮助您的吗？
                </div>
              </div>
            </div>
            <div class="loader" id="loader">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <div class="input-container">
              <textarea id="input" placeholder="请输入您的问题..."></textarea>
              <button id="pauseBtn" title="暂停响应"></button>
              <button id="sendBtn" title="发送"></button>
              <div class="voice-controls">
                <button class="voice-btn" id="startVoice">
                  <i class="fas fa-microphone"></i>
                </button>
                <!-- 添加文件上传按钮 -->
                <button class="voice-btn" id="uploadBtn" title="上传文件">
                  <i class="fas fa-file-upload"></i>
                </button>
                <input type="file" id="fileInput" accept=".txt,.docx,.pdf,.jpg,.jpeg,.png,.gif" style="display: none;">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 历史记录模态框 (保持不变，以防需要回退) -->
  <div id="historyModal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <h2>对话历史</h2>
      <div class="history-controls">
        <input type="text" id="searchInput" placeholder="输入关键词搜索">
        <button id="refreshHistoryBtn" class="refresh-btn">
          <i class="fas fa-sync-alt"></i> 刷新
        </button>
      </div>
      <div id="historyList"></div>
    </div>
  </div>
  
  <!-- 用户信息模态框 -->
  <div id="userInfoModal" class="modal">
    <div class="modal-content">
      <span class="close-btn close-user-info">&times;</span>
      <h2>用户信息</h2>

      <!-- 个人信息编辑区 - 移到前面 -->
      <div class="user-stats">
        <div class="stat-item">
          <div class="stat-label"><i class="fas fa-user-edit"></i> 用户名</div>
          <input type="text" id="userNameInput" class="stat-value" />
        </div>
        <div class="stat-item">
          <div class="stat-label"><i class="fas fa-envelope"></i> 邮箱</div>
          <div class="stat-value" id="userEmailDisplay"></div>
        </div>
        <div class="stat-item">
          <div class="stat-label"><i class="fas fa-image"></i> 头像</div>
          <div class="stat-value">
            <img id="avatarImg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAlWVYSWZNTQAqAAAACAAEAQAAAwAAAAEFJwAAAQEAAwAAAAEElgAAh2kABAAAAAEAAAA+ARIAAwAAAAEAAQAAAAAAAAACkoYAAgAAAA8AAABckggABAAAAAEAAAAAAAAAAE9wbHVzXzE2OTA4Mjg4AAADvElEQVRYCe2XS2sTQRSGHyUhohJBghBpUuLIHtghgUpkNSQPqg6NRNw6cOHCxWfgQrVShfQX/Ai/gQIv4UWrZWs2Kixv01T9qjKoa9n5vL1l3dn95X8nNvrxkLzUIIYQQQvhxq3wLwAwgVdyusx9UBvSDVhWQTlQFKvejlWf8iCeMOypJdFh9cz1kHckm/wWFdn1DE9FcISiqDKcBNRRGdrho3hV1l7GVbNMYJcFiabPSl4G45t45thTLVf6B6B3wGgA4At1utw4bWIhj/0Vq1F7nqwADtDdoFxFzjcU26KDM4z3cNqNd30A5GLP5m6wF6JY5t6RZFlKItAF1hDQqCqUEZEvU4oJcHkF4zQQaL2tsWe8pPeYdMkqKhq6Z2kVJggdBUnVaQbUN4CzoYOg5nd7T7gC8gA3W2u4U6YMrJbHz5SKvhBqVmbEoMZgO9gnzCzRrLBGa8ALXIpn9C9nyJElPlH6uIfrwPsGtlk7YcwCDM/vJwSuWx11jt3RYA91iDqpv+TK5xzOBo64y49k2jQMe07A3HZjFbZ4A+msTKLgRRoYtkixM2VbBiXJSZ3FsAamNImf1gFZ9TIKAZ3KzOIoF6mjAqlUlgqUnbMuTFeuAa7sGlIYZlI3NcdjAqPQWYZFhxSDgCMXGIrj6dgC5KXGFpQkhxKHYSKx4rRkOcFjbQx8RIaTfH6DFIF9XAkxV2V/wB6hBnylUwwYBvmBPo2FxepuM5noEOGaX5R2U7gLNeG8Ox05sIfQ93yPgei8gwDNb+0AtXyq9kgTA2Zd6VGHYIRvAKTEm4uUypT7gTuyNGRDo3yY26Y9Z4WqK+wGS8WkMr7qdifJ9bQPSiE+tUAl5TgqbH/wYmvHoEYXBA1pbgqf3UGa3n1ja6Xnfnok0W3yeiW6OvmKy3OqXjPgvnNkR+FPKfKwbxSWvwAAAABJRU5ErkJggg==" alt="头像" class="small-avatar" />
            <input type="file" id="avatarUpload" accept="image/*" style="margin-top: 10px;" />
          </div>
        </div>
      </div>

      <!-- 统计信息区 - 减小占位 -->
      <div class="info-grid compact">
        <div class="info-card small">
          <i class="fas fa-calendar-alt"></i>
          <div class="info-title">注册时间</div>
          <div class="info-value" id="regDate"></div>
        </div>
        <div class="info-card small">
          <i class="fas fa-comments"></i>
          <div class="info-title">对话数</div>
          <div class="info-value" id="conversationCount"></div>
        </div>
        <div class="info-card small">
          <i class="fas fa-calendar-check"></i>
          <div class="info-title">登录次数</div>
          <div class="info-value" id="activeDays"></div>
        </div>
      </div>

      <button id="saveUserInfoBtn" class="submit-btn" style="margin-top: 30px;">保存</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <!-- 初始化 Supabase 客户端 -->
  <script>
    const SUPABASE_URL = 'https://sfathljcqvsqtazfcohb.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNmYXRobGpjcXZzcXRhemZjb2hiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNzYxNTAsImV4cCI6MjA2OTk1MjE1MH0.e0h04FnSKOnoPDDVU1LqpgpofT5mJiym1QrB1NFZfQ4';
    
    // 等待Supabase库加载完成后再初始化
    function initSupabase() {
      if (typeof supabase !== 'undefined' && typeof supabase.createClient === 'function') {
        // 全局定义supabase对象
        window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        console.log('Supabase client initialized successfully');
      } else {
        console.error('Supabase library not loaded correctly or createClient method not available');
        // 如果初始化失败，稍后重试
        setTimeout(initSupabase, 1000);
      }
    }
    
    // 页面加载完成后初始化Supabase
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initSupabase);
    } else {
      initSupabase();
    }
  </script>
  
  <!-- 3. 然后加载其他依赖Supabase的脚本 -->
  <script src="supabase.js"></script>
  <script src="account.js"></script>
  <script src="chat.js"></script>
  <script src="app.js"></script>
  <script src="reset-password.js"></script>
  <script src="strength-meter.js"></script>
  <script src="theme.js"></script>
  <!-- 引入文档解析库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
</body>
</html>